From: Laurent Fousse <laurent@komite.net>
Date: Sat, 28 Apr 2012 13:08:39 -0700
Subject: Apply upstream patch05, fixing a freeze when using logging.

---
 PATCHES       |    1 +
 VERSION       |    2 +-
 src/add_d.c   |    2 +-
 src/add_ui.c  |    2 +-
 src/mpfr.h    |    2 +-
 src/mul_d.c   |    2 +-
 src/version.c |    2 +-
 7 files changed, 7 insertions(+), 6 deletions(-)

diff --git a/PATCHES b/PATCHES
index 0930fe8..098a20f 100644
--- a/PATCHES
+++ b/PATCHES
@@ -1,3 +1,4 @@
+logging-freeze
 gmp41compat
 vasprintf
 mpfr_unlikely
diff --git a/VERSION b/VERSION
index c589ee6..747f9b9 100644
--- a/VERSION
+++ b/VERSION
@@ -1 +1 @@
-3.1.0-p4
+3.1.0-p5
diff --git a/src/add_d.c b/src/add_d.c
index 3a1de86..c9cf62b 100644
--- a/src/add_d.c
+++ b/src/add_d.c
@@ -34,7 +34,7 @@ mpfr_add_d (mpfr_ptr a, mpfr_srcptr b, double c, mpfr_rnd_t rnd_mode)
     (("b[%Pu]=%.*Rg c=%.20g rnd=%d",
       mpfr_get_prec(b), mpfr_log_prec, b, c, rnd_mode),
      ("a[%Pu]=%.*Rg inexact=%d",
-      mpfr_get_prec (a), mpfr_get_prec, a, inexact));
+      mpfr_get_prec (a), mpfr_log_prec, a, inexact));
 
   MPFR_SAVE_EXPO_MARK (expo);
 
diff --git a/src/add_ui.c b/src/add_ui.c
index 156173a..776e1e8 100644
--- a/src/add_ui.c
+++ b/src/add_ui.c
@@ -29,7 +29,7 @@ mpfr_add_ui (mpfr_ptr y, mpfr_srcptr x, unsigned long int u, mpfr_rnd_t rnd_mode
   MPFR_LOG_FUNC
     (("x[%Pu]=%.*Rg u=%d rnd=%d",
       mpfr_get_prec(x), mpfr_log_prec, x, u, rnd_mode),
-     ("y[%Pu]=%.*Rg", mpfr_get_prec (y), mpfr_get_prec, y));
+     ("y[%Pu]=%.*Rg", mpfr_get_prec (y), mpfr_log_prec, y));
 
   if (MPFR_LIKELY(u != 0) )  /* if u=0, do nothing */
     {
diff --git a/src/mpfr.h b/src/mpfr.h
index 30fbe93..86ad1d8 100644
--- a/src/mpfr.h
+++ b/src/mpfr.h
@@ -27,7 +27,7 @@ http://www.gnu.org/licenses/ or write to the Free Software Foundation, Inc.,
 #define MPFR_VERSION_MAJOR 3
 #define MPFR_VERSION_MINOR 1
 #define MPFR_VERSION_PATCHLEVEL 0
-#define MPFR_VERSION_STRING "3.1.0-p4"
+#define MPFR_VERSION_STRING "3.1.0-p5"
 
 /* Macros dealing with MPFR VERSION */
 #define MPFR_VERSION_NUM(a,b,c) (((a) << 16L) | ((b) << 8) | (c))
diff --git a/src/mul_d.c b/src/mul_d.c
index db23721..d14e240 100644
--- a/src/mul_d.c
+++ b/src/mul_d.c
@@ -34,7 +34,7 @@ mpfr_mul_d (mpfr_ptr a, mpfr_srcptr b, double c, mpfr_rnd_t rnd_mode)
     (("b[%Pu]=%.*Rg c=%.20g rnd=%d",
       mpfr_get_prec(b), mpfr_log_prec, b, c, rnd_mode),
      ("a[%Pu]=%.*Rg inexact=%d",
-      mpfr_get_prec (a), mpfr_get_prec, a, inexact));
+      mpfr_get_prec (a), mpfr_log_prec, a, inexact));
 
   MPFR_SAVE_EXPO_MARK (expo);
 
diff --git a/src/version.c b/src/version.c
index 10eafe4..b3e6abd 100644
--- a/src/version.c
+++ b/src/version.c
@@ -25,5 +25,5 @@ http://www.gnu.org/licenses/ or write to the Free Software Foundation, Inc.,
 const char *
 mpfr_get_version (void)
 {
-  return "3.1.0-p4";
+  return "3.1.0-p5";
 }
